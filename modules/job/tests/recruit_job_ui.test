<?php

/**
 * @file
 * Functional tests for the job module.
 */

/**
 * Test the job and job type CRUD.
 */
class RecruitJobUIAdminTest extends RecruitBaseTestCase {
  
  public static function getInfo() {
    return array(
      'name' => 'Recruit job administration UI',
      'description' => 'Tests creating, deleting and editing jobs and job types.',
      'group' => 'Recruit',
    );
  }

  function setUp() {
    parent::setUp('recruit_application_ui', 'recruit_job_ui');

    // User creation for different operations.
    $this->recruit_admin = $this->createRecruitAdmin();
    $this->recruiter = $this->createRecruiter();
    $this->candidate = $this->createCandidate();
  }
  
  /**
   * Test the admin menus for jobs.
   */
  public function testRecruitJobUIAdminMenus() {
    // Login with recruit admin.
    $this->drupalLogin($this->recruit_admin);

    // Access to the recruit admin section.
    $this->drupalGet('admin/recruit');
    $this->assertResponse(200, t('Recruit admin user can access the recruit admin section'));

    // Ensure link to job list is present.
    $this->assertText(t('Jobs'), t('%jobs link is present in the recruit admin section (admin/recruit)', array('%jobs' => t('Jobs'))));
    // Ensure that the "Create job" link does NOT appear in the recruit admin section (admin/recruit).
    $this->assertNoText(t('Create job'), t('Ensure that the "%createjob" link does NOT appear in the recruit admin section (admin/recruit)', array('%createjob' => t('Create job'))));
  }

  /**
   * Test the permissions to access the job listing.
   */
  public function testRecruitJobUIAccessJobList() {
    // Login with normal user.
    $this->drupalLogin($this->candidate);

    // Access to the admin job list.
    $this->drupalGet('admin/recruit/jobs');

    $this->assertResponse(403, t('Normal user is not able to access the job admin list page'));


    // Login as recruiter.
    $this->drupalLogin($this->recruiter);

    // Access to the admin job list.
    $this->drupalGet('admin/recruit/jobs');

    $this->assertResponse(200, t('Recruiter user can access the job admin list page'));

    // Ensure that the link is NOT available to recriters.
    $this->assertNoText(t('Create job'), t('%createjob link is NOT present in the admin list page', array('%createjob' => t('Create job'))));
    // Ensure that the views empty is present.
    $this->assertText(t('No jobs have been created yet.'), t('The views empty text "%job_empty_text" should appear.', array('%job_empty_text' => t('No jobs have been created yet.'))));

    // Login with recruit admin.
    $this->drupalLogin($this->recruit_admin);

    // Access to the admin job list.
    $this->drupalGet('admin/recruit/jobs');

    $this->assertResponse(200, t('Recruit admin user can access the job admin list page'));

    // Ensure that the link for creating jobs is in place.
    $this->assertText(t('Create job'), t('%createjob link is present in the admin list page', array('%createjob' => t('Create job'))));
    // Ensure that the views empty is present.
    $this->assertText(t('No jobs have been created yet.'), t('The views empty text "%job_empty_text" should appear.', array('%job_empty_text' => t('No jobs have been created yet.'))));
  }
}