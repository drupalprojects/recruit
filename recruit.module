<?php

/**
 * @file
 * Global recruit module.
 */

/**
 * Implements hook_menu().
 */
function recruit_menu() {
  $items = array();

  $items['admin/recruit'] = array(
    'title' => 'Recruit',
    'description' => 'Administer your jobs and applications.',
    'page callback' => 'system_admin_menu_block_page',
    'access arguments' => array('access recruit administration pages'),
    'file path' => drupal_get_path('module', 'system'),
    'file' => 'system.admin.inc',
  );
  /*
  $items['admin/recruit/config'] = array(
    'title' => 'Configuration',
    'description' => 'Configure settings for your recruitment site.',
    'page callback' => 'system_admin_menu_block_page',
    'access arguments' => array('access administration pages'),
    'type' => MENU_NORMAL_ITEM,
    'weight' => 10,
    'file path' => drupal_get_path('module', 'system'),
    'file' => 'system.admin.inc',
  );
   *
   */
  return $items;
}

/**
 * Implements hook_entity_info().
 */
function recruit_entity_info() {
  $return =  array(
    'recruit_application' => array(
      'label' => t('Application'),
      'entity class' => 'RecruitApplication',
      'controller class' => 'EntityAPIController',      
      'base table' => 'recruit_application',
      'uri callback' => 'recruit_application_uri_callback',
      // 'access callback' => 'recruit_application_access',
      'module' => 'recruit_application',
      'fieldable' => TRUE,
      'entity keys' => array(
        'id' => 'aid',
        'bundle' => 'node_type',
        'label' => 'aid',
      ),
      'bundles' => array(),
      'view modes' => array(
        'full' => array(
          'label' => t('Full application'),
          'custom settings' => FALSE,
        ),
      ),
      'static cache' => FALSE,
    ),
  );

  foreach (node_type_get_names() as $type => $name) {
    $return['recruit_application']['bundles']['recruit_application_node_' . $type] = array(
      'label' => t('@node_type application', array('@node_type' => $name)),
      'admin' => array(
        'path' => 'admin/structure/types/manage/%recruit_application_node_type/application',
        'bundle argument' => 4,
        'real path' => 'admin/structure/types/manage/' . str_replace('_', '-', $type) . '/application',
        'access arguments' => array('administer content types'),
      ),
    );
  }

  return $return;
}

/**
 * Finds all fields of a particular field type.
 *
 * @param $field_type
 *   The type of field to search for.
 * @param $entity_type
 *   Optional entity type to restrict the search to.
 *
 * @return
 *   An array of the matching fields keyed by the field name.
 */
function recruit_info_fields($field_type, $entity_type = NULL) {
  $fields = array();

  foreach (field_info_fields() as $field_name => $field) {
    if ($field['type'] == $field_type) {
      // Add this field to the return array if no entity type was specified or
      // if the specified type exists in the field's bundles array.
      if (empty($entity_type) || in_array($entity_type, array_keys($field['bundles']))) {
        $fields[$field_name] = $field;
      }
    }
  }

  return $fields;
}

/**
 * Load a single entity object using the passed in entity_type and entity_id
 *
 * @param $entity_type
 *   The type of entity
 * @param $entity_id
 *   The id of the entity
 *
 * @return
 *   An entity object.
 */
function recruit_entity_load_single($entity_type, $entity_id) {
  $entity_load = entity_load($entity_type, array($entity_id));

  if (!empty($entity_load)) {
    $entity = $entity_load[$entity_id];

    //Adding extra entity information.
    $entity->entity_type = $entity_type;
    $entity->entity_id = $entity_id;
    return $entity;
  }
}

/**
 * Implements hook_permission().
 */
function recruit_permission() {
  $permissions = array(
    'access recruit administration pages' =>  array(
      'title' => t('Access recruit administration pages'),
      'description' => t('Access drupal recruits administration pages'),
    ),
  );

  return $permissions;
}

/**
 * Implements hook_forms().
 */
function recruit_forms() {
  $forms = array();
  foreach (node_type_get_types() as $type) {
    $forms["recruit_application_node_" . $type->type . "_form"]['callback'] = 'recruit_application_application_form';
  }
  return $forms;
}